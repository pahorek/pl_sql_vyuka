CREATE TABLE CESTA (
    CESTA_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    CESTA VARCHAR2(1000) UNIQUE
);
CREATE TABLE JMENO_SOUBORU (
    ID_JMENO_SOUBORU NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    JMENO_SOUBORU VARCHAR2(500) UNIQUE,
    CESTA_ID NUMBER NOT NULL,
    CONSTRAINT FK_SOUBOR_CESTA FOREIGN KEY (CESTA_ID)
        REFERENCES CESTA(CESTA_ID)
);

CREATE TABLE ListExcel (
    ID_ListExcel NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    NAZEV_LISTU VARCHAR2(255) NOT NULL,
    ID_JMENO_SOUBORU NUMBER NOT NULL,
    CONSTRAINT FK_ListExcel_Soubor FOREIGN KEY (ID_JMENO_SOUBORU)
        REFERENCES JMENO_SOUBORU(ID_JMENO_SOUBORU),
    CONSTRAINT UQ_ListExcel UNIQUE (ID_JMENO_SOUBORU, NAZEV_LISTU)
);
CREATE TABLE JMENO_TABULKY (
    ID_JMENO_TABULKY NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    NAZEV_TABULKY VARCHAR2(255) NOT NULL,
    ID_ListExcel NUMBER NOT NULL,

    CONSTRAINT FK_JT_ListExcel FOREIGN KEY (ID_ListExcel)
        REFERENCES ListExcel(ID_ListExcel),

    CONSTRAINT UQ_JT UNIQUE (ID_ListExcel, NAZEV_TABULKY)
);

CREATE TABLE BUNKA (
    ID_BUNKA NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    RADek NUMBER NOT NULL,
    SLOUPEC NUMBER NOT NULL,
    ID_ListExcel NUMBER NOT NULL,
    ID_JMENO_TABULKY NUMBER NULL,

    CONSTRAINT FK_BUNKA_LIST FOREIGN KEY (ID_ListExcel)
        REFERENCES ListExcel(ID_ListExcel),

    CONSTRAINT FK_BUNKA_TAB FOREIGN KEY (ID_JMENO_TABULKY)
        REFERENCES JMENO_TABULKY(ID_JMENO_TABULKY),

    CONSTRAINT UQ_BUNKA UNIQUE (ID_ListExcel, RADek, SLOUPEC)
);

CREATE TABLE HODNOTY_ALT (
    ID_HODNOTY NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    ID_BUNKA NUMBER NOT NULL,
    ID_JMENO_TABULKY NUMBER NULL,

    ROK_PUBL INTEGER,
    Q_PUBL INTEGER,
    HODN_ROK INTEGER,
    HODN_Q INTEGER,
    VERZE VARCHAR2(4),
    ULOHA VARCHAR2(100),

    HODNOTA NUMBER,
    ROK NUMBER(4),
    KVARTAL NUMBER(1),
    DATUM_IMPORTU DATE DEFAULT SYSDATE,

    CONSTRAINT FK_HODNOTY_BUNKA FOREIGN KEY (ID_BUNKA)
        REFERENCES BUNKA(ID_BUNKA),

    CONSTRAINT FK_HODNOTY_TAB FOREIGN KEY (ID_JMENO_TABULKY)
        REFERENCES JMENO_TABULKY(ID_JMENO_TABULKY)
);
CREATE TABLE CESTA (
    CESTA_ID NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    CESTA VARCHAR2(1000) UNIQUE
);
CREATE TABLE JMENO_SOUBORU (
    ID_JMENO_SOUBORU NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    JMENO_SOUBORU VARCHAR2(500) UNIQUE,
    CESTA_ID NUMBER NOT NULL,
    CONSTRAINT FK_SOUBOR_CESTA FOREIGN KEY (CESTA_ID)
        REFERENCES CESTA(CESTA_ID)
);

CREATE TABLE ListExcel (
    ID_ListExcel NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    NAZEV_LISTU VARCHAR2(255) NOT NULL,
    ID_JMENO_SOUBORU NUMBER NOT NULL,
    CONSTRAINT FK_ListExcel_Soubor FOREIGN KEY (ID_JMENO_SOUBORU)
        REFERENCES JMENO_SOUBORU(ID_JMENO_SOUBORU),
    CONSTRAINT UQ_ListExcel UNIQUE (ID_JMENO_SOUBORU, NAZEV_LISTU)
);
CREATE TABLE JMENO_TABULKY (
    ID_JMENO_TABULKY NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    NAZEV_TABULKY VARCHAR2(255) NOT NULL,
    ID_ListExcel NUMBER NOT NULL,

    CONSTRAINT FK_JT_ListExcel FOREIGN KEY (ID_ListExcel)
        REFERENCES ListExcel(ID_ListExcel),

    CONSTRAINT UQ_JT UNIQUE (ID_ListExcel, NAZEV_TABULKY)
);

CREATE TABLE BUNKA (
    ID_BUNKA NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    RADek NUMBER NOT NULL,
    SLOUPEC NUMBER NOT NULL,
    ID_ListExcel NUMBER NOT NULL,
    ID_JMENO_TABULKY NUMBER NULL,

    CONSTRAINT FK_BUNKA_LIST FOREIGN KEY (ID_ListExcel)
        REFERENCES ListExcel(ID_ListExcel),

    CONSTRAINT FK_BUNKA_TAB FOREIGN KEY (ID_JMENO_TABULKY)
        REFERENCES JMENO_TABULKY(ID_JMENO_TABULKY),

    CONSTRAINT UQ_BUNKA UNIQUE (ID_ListExcel, RADek, SLOUPEC)
);

CREATE TABLE HODNOTY_ALT (
    ID_HODNOTY NUMBER GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    ID_BUNKA NUMBER NOT NULL,
    ID_JMENO_TABULKY NUMBER NULL,

    ROK_PUBL INTEGER,
    Q_PUBL INTEGER,
    HODN_ROK INTEGER,
    HODN_Q INTEGER,
    VERZE VARCHAR2(4),
    ULOHA VARCHAR2(100),

    HODNOTA NUMBER,
    ROK NUMBER(4),
    KVARTAL NUMBER(1),
    DATUM_IMPORTU DATE DEFAULT SYSDATE,

    CONSTRAINT FK_HODNOTY_BUNKA FOREIGN KEY (ID_BUNKA)
        REFERENCES BUNKA(ID_BUNKA),

    CONSTRAINT FK_HODNOTY_TAB FOREIGN KEY (ID_JMENO_TABULKY)
        REFERENCES JMENO_TABULKY(ID_JMENO_TABULKY)
);

INSERT INTO CESTA (CESTA) VALUES ('C:\Data\Import2026');
INSERT INTO JMENO_SOUBORU (JMENO_SOUBORU, CESTA_ID)
VALUES ('Vystup_leden.xlsx', 1);
INSERT INTO ListExcel (NAZEV_LISTU, ID_JMENO_SOUBORU)
VALUES ('Data_2026', 1);
INSERT INTO JMENO_TABULKY (NAZEV_TABULKY, ID_ListExcel)
VALUES ('Tabulka_A', 1);
INSERT INTO BUNKA (RADEK, SLOUPEC, ID_ListExcel, ID_JMENO_TABULKY)
VALUES (5, 3, 1, 1);
INSERT INTO HODNOTY_ALT (
    ID_BUNKA, 
    ID_JMENO_TABULKY,
    ROK_PUBL, Q_PUBL,
    HODN_ROK, HODN_Q,
    VERZE, ULOHA,
    HODNOTA, ROK, KVARTAL
)
VALUES (
    1,
    1,
    2025, 4,
    2026, 1,
    '0001',
    'Test výpočtu A1',
    123.45,
    2026, 1
);



SELECT 
    -- CESTA
    c.CESTA_ID,
    c.CESTA,

    -- SOUBOR
    s.ID_JMENO_SOUBORU,
    s.JMENO_SOUBORU,

    -- LIST
    l.ID_ListExcel,
    l.NAZEV_LISTU,

    -- TABULKA (volitelná)
    jt.ID_JMENO_TABULKY,
    jt.NAZEV_TABULKY,

    -- BUNKA
    b.ID_BUNKA,
    b.RADEK,
    b.SLOUPEC,

    -- HODNOTY_ALT
    h.ID_HODNOTY,
    h.ROK_PUBL, h.Q_PUBL,
    h.HODN_ROK, h.HODN_Q,
    h.VERZE, h.ULOHA,
    h.HODNOTA,
    h.ROK, h.KVARTAL,
    h.DATUM_IMPORTU

FROM HODNOTY_ALT h
JOIN BUNKA b 
    ON h.ID_BUNKA = b.ID_BUNKA
LEFT JOIN JMENO_TABULKY jt 
    ON b.ID_JMENO_TABULKY = jt.ID_JMENO_TABULKY
JOIN ListExcel l 
    ON b.ID_ListExcel = l.ID_ListExcel
JOIN JMENO_SOUBORU s 
    ON l.ID_JMENO_SOUBORU = s.ID_JMENO_SOUBORU
JOIN CESTA c 
    ON s.CESTA_ID = c.CESTA_ID;

